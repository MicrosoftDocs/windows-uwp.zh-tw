---
title: 連接儲存體最佳做法
description: 如何獲得最佳效能，並體驗從連接的儲存體建議
ms.date: 02/27/2018
ms.topic: article
keywords: xbox live、 xbox、 遊戲、 uwp、 windows 10、 xbox 一個連接的儲存體
ms.localizationpriority: medium
ms.openlocfilehash: dbdb8f95e9afc44a3280d897e74f74d327f94b97
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2019
ms.locfileid: "57632923"
---
# <a name="connected-storage-best-practices"></a>連接的儲存空間最佳做法

開發人員應該儲存的資料分成邏輯群組，也就是獨立更新，而不是撰寫整合型儲存。 這可讓項目，以減少它們在各種情況下，這兩個本機資源耗用量降低寫入的資料量，並上傳頻寬使用量。 API 也可讓更新可保證完全成功，或完全 （比方說在災難性失敗期間儲存） 不會生效的不可部分完成作業中的多個資料項目的標題。

Xbox One 允許使用者在標題之間快速切換，因為開發人員應該設計要保留其目前狀態已準備好在短時間預期接收暫止的事件，這種情形幾乎在任何時間儲存其標題。 連接儲存體 API 使用 RAM 之外標題保留做為第一個點的儲存體，才能達到標題寫入速度在短期間的最大暫止時間範圍。 系統接著保存到永久性儲存體資料、 文字與任何其他資料寫入調解自上次上傳，並排程資料上傳。 一旦儲存並上傳排入佇列，系統就會是強固網路連線遺失或電源故障等各種失敗。

## <a name="when-to-load-a-users-connected-storage-space-data"></a>若要載入的使用者連接的儲存體空間資料的時機

所載入的使用者連接的儲存體資料空間的執行時間而有所不同。 應用程式應該採取此動作，主要在執行期間，而不是以回應使用者起始登出，或從系統接收擱置通知的回應。
一般而言，應用程式應該載入連接的儲存體空間，當使用者登入，並指出想播放，除非在遊戲的模式，就特定否儲存功能所需。 您也應該考慮對齊長串的資料載入與連接的儲存空間的載入，讓作業可以平行執行。
您的應用程式載入後的使用者連接的儲存體空間資料，它應該保留未來將此值。 保留連接的儲存空間經過一段時間沒有負面影響效能或穩定性。 因為載入連接的儲存空間與雲端導致同步處理檢查，如果系統已上線，釋出和重新載入期間變慢的使用者連接的儲存空間，或不可靠的網路狀況可能會造成使用者看到的同步處理 UI之前在系統逾時。連接儲存體空間不需要明確地釋放，讓雲端同步處理。 一次完成處理常式中指定`SubmitUpdatesAsync`呼叫傳回與`AsyncStatus::Completed`，系統會處理與雲端同步處理的應用程式釋出是否`ConnectedStorageSpace`物件。

## <a name="when-to-save"></a>若要儲存的時機

每當應用程式收到的暫止通知，應用程式應該至少會儲存相關的資料，讓系統回到使用者當前的狀態。

可以呼叫頻率遠高於時接收暫止通知; 如果您的遊戲設計使用定期，自動進行，或使用者啟動的儲存、 連接的儲存體這動作的好方法，以減少因電源遺失或損毀的資料遺失的風險。
如果您正在開發的 XDK 製作遊戲，當使用者登出時，該使用者的使用者物件會維持有效，而在該時間的應用程式可能會執行最終請使用連接儲存體以儲存作業。

## <a name="robustness"></a>加強性

已儲存的資料一律會同步至雲端中，因為無法備份在雲端中儲存的資料和應用程式程式碼讓應用程式損毀的錯誤，然後分散到裝置。 若要防止使用者不需要在每個啟動損毀的應用程式，設計應用程式，以確定：

-   使用者可以觸達的他們可以管理已儲存的狀態，應用程式中的點，即使某些已儲存的資料格式不正確。
-   應用程式可以自動處理資料損毀，復原可能的資料量，並重新初始化至安全的狀態，其他所有項目。

## <a name="use-cases-for-save-game-designs"></a>儲存遊戲設計的使用案例

將系統，可在連接的儲存空間的最佳使用容器儲存的遊戲設計取決於應用程式的類型：

### <a name="single-save"></a>單一的儲存

針對使用單一的應用程式，行銷活動樣式會儲存系統，例如第一次的人員射擊：

-   將所有資料放入單一容器，並永遠寫入相同的容器，以名稱來識別。
-   請考慮公開的所有資料，將會清除所有使用者的已儲存的資料，在時重都設他或她想要開始從一開始，應用程式使用任何先前的進度，而保留的選項。

### <a name="multiple-saves"></a>多個儲存

對於有固定的數目的儲存位置，讓我們假設五個的應用程式，有兩種方式可以使用容器來儲存遊戲資料：

-   針對每個儲存位置使用 1 個 blob，以儲存一個固定名稱的容器內的所有 5 個位置。 使用這個方法，所有的 5 個位置會完整同步處理且隨時可用，或者，在任何時間點的同步處理失敗的情況下，沒有任何位置將會同步處理而且不會在先前的狀態。 如果使用者可以離線的應用程式播放上兩個不同的主控台儲存進度插槽 1 中第一個主控台上和插槽 2 中的第二個主控台上，使用者必須選擇要連接這兩個主控台連接到 Xbox Live; 保留的資料適用於容器的合併邏輯會產生衝突。
-   在其本身名稱的容器中儲存每個位置。 這可讓每個插槽，即使在多個可能暫時離線的電腦上的獨立進行。 不過，如果使用者中途取消透過同步處理，則可能只對某些位置將會提供該工作階段;某些容器可能無法完成下載。 在此情況下，同步處理已完成，而且有些雲端資料不會本機主控台上，會通知使用者。

使用任何方法時，應用程式，應該會提供 UI 來刪除個別的儲存位置的使用者。

### <a name="warning"></a>警告

**要將相依的資料儲存在容器。** 不跨越多個容器會儲存具有相依性的資料。 容器可以區隔，因為不完整的同步處理、 電源中斷或其他錯誤狀況。 自給自足且自我一致，就必須是單一容器中儲存的資料。

### <a name="tips"></a>提示

**不阻止使用者關閉主控台，或瀏覽離開此處。** 您的標題應該不會阻止使用者關閉主控台，或儲存時離開您的應用程式。 在 Xbox 360，如果使用者關閉系統正在儲存您的標題，而使用者的資料不會儲存。 Xbox One 上您的標題會接收暫止的事件，並已使用連接儲存體 API 以儲存狀態的 1 秒。 系統可確保資料是正確認可到硬碟時，它完全關機或進入低電源狀態之前。 如果使用者退出播放另一個標題的光碟，就會發生相同的暫止處理程序。

**保留連接的儲存空間。** 保留 ConnectedStorageSpace 物件，而不是嘗試將每次讀取或寫入的事件發生時將其載入。 沒有任何負面的影響效能或造成會長時間保留 ConnectedStorageSpace 物件的健全性。

**小的資料大小。** 小已儲存的資料的大小。 當主控台連線，連接的儲存體中的所有使用者資料上都傳至雲端。 最佳化您的資料格式，以確保最少的延遲和頻寬使用量。

**請確認使用者不介意不儲存。** 請檢查 OutOfLocalStorage GetForUserAsync 和 SubmitUpdatesAsync，和查詢使用者，以查看他們是否真的想要播放而不儲存傳回的錯誤。 如果使用者表示想要儲存的遊戲，重試此作業。

**請檢查使用者的配額，並清除空間的提示。** 傳回 SubmitUpdatesAsync QuotaExceeded 錯誤檢查。 如果您的應用程式收到這則訊息，通知使用者，他們就無法儲存更多資料，直到它們先釋放一些空間，並顯示它們，讓他們執行這項操作的 UI。 每位使用者取得 64 或 256 MB 的資料，每個應用程式，而每個 XDK 標題取得 64 MB 的每台機器儲存體為本機到主控台。

**儲存狀態的功能表，稍後再還原。** 儲存功能表的狀態和其他應用程式設定，除了儲存遊戲的核心資料。 如果使用者扮演另一個應用程式，並再回來與您，請將它們還原至符合當前的功能表狀態。
回應登入使用者的變更。 使用者可以登出中，這是您的應用程式暫停。 繼續應用程式時，它應該判斷是否已變更的登入的使用者集合。 請考慮當發生這種情況時，瀏覽至應用程式，像是功能表內的適當位置。

**提供 UI 來管理已儲存的資料。** 您的應用程式應該提供 UI，可讓使用者管理其應用程式內所儲存的資料。 針對具有自動儲存系統的應用程式，應用程式應該提供一個選項來重設已儲存的資料，讓使用者能夠重設為預設播放狀態。

**確保使用者一律可以觸達 UI 來管理儲存的遊戲。** 確保您的應用程式一律可以觸達其管理 UI，適用於已儲存的遊戲，即使發生錯誤，已儲存的資料。 如果使用者的已儲存的資料變得無法讀取，因為應用程式錯誤或資料損毀，應用程式應該允許使用者復原的狀態且不會損毀，或防止播放。