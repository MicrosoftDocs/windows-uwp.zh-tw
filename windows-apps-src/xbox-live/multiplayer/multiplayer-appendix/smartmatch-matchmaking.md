---
title: SmartMatch 配對
description: 深入了解多人遊戲中的比對玩家的 Xbox Live SmartMatch 配對服務。
ms.assetid: ba0c1ecb-e928-4e86-9162-8cb456b697ff
ms.date: 04/04/2017
ms.topic: article
keywords: xbox live、 xbox、 遊戲、 uwp、 windows 10、windows xbox one，多人遊戲，配對，smartmatch
ms.localizationpriority: medium
ms.openlocfilehash: 6bc5f15e6fdb7d2f393daef8d21c134579610a9b
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2019
ms.locfileid: "57647293"
---
# <a name="smartmatch-matchmaking"></a>SmartMatch 配對

本文包含下列各節
* SmartMatch 簡介
* SmartMatch 執行階段作業
* 設定 SmartMatch 標題
* SmartMatch 設定期間定義小組規則
* 目標工作階段初始化與 QoS

## <a name="introduction-to-smartmatch"></a>SmartMatch 簡介

XSAPI 提供配對服務，稱為 SmartMatch 包裝[多人遊戲管理員 API](../multiplayer-manager/multiplayer-manager-api-overview.md)。  針對進階 API 使用方式，您可以參考**MatchmakingService 類別**，但如果您發現您有不可能使用多人遊戲管理員實作的配對案例，請提供意見反應給我們透過您補西牆。  不論您使用的 API，適用於這篇文章中的概念資訊。

SmartMatch 配對群組根據使用者資訊和配對要求的使用者想要一起玩的玩家。 配對是伺服器為基礎，這表示使用者提供服務的要求，而且它們會在找到相符項目時稍後收到通知。 在建置時標題 Xbox One，如中所述，您可以使用 SmartMatch[使用 SmartMatch 配對](using-smartmatch-matchmaking.md)。 或者，您可以自己配對的服務中所述[使用您自己的配對服務](https://developer.microsoft.com/en-us/games/xbox/docs/xboxlive/xbox-live-partners/multiplayer-and-networking/using-your-own-matchmaking-service)。 請注意，存取此連結，您必須擁有[合作夥伴中心](https://partner.microsoft.com/dashboard)Xbox Live 開發已啟用的帳戶。

### <a name="about-smartmatch"></a>關於 SmartMatch

配對服務密切搭配 MPSD 簡化配對。 它可讓標題輕鬆地執行在背景中，例如當使用者在播放單人配對中的標題。

個人或群組，想要輸入配對建立比對的票證工作階段，然後要求配對服務，來尋找要與其相符項目所設定的其他播放程式。 這會導致建立暫存檔 」 比對票證 」 位於配對服務一段時間內。

配對服務選擇播放工作階段設定中，根據儲存以供每個玩家和比對要求的時間在指定的任何其他資訊的統計資料。 服務接著會建立包含所有球員都符合，並通知使用者的項目比對的比對目標工作階段。

備妥的目標工作階段時，標題就會執行 QoS 檢查，若要確認群組可以玩在一起，而且如果一切正常，然後開始播放。 QoS 程序和 matchmade 遊戲時發生，標題保持最新狀態內 MPSD，工作階段狀態，它們接收通知 MPSD 從變更的相關工作階段。 這類變更使用者外傳，和變更工作階段仲裁程式。


### <a name="match-ticket-session"></a>比對票證工作階段

比對的票證工作階段代表想要讓比對的球員的用戶端。 它是根據建立遊戲，或一群人員一起大廳中陌生人或播放程式的其他特定標題的群組。 在某些情況下，票證工作階段可能已經在進行尋找的更多玩家遊戲工作階段。


### <a name="match-ticket"></a>符合票證

提交配對的票證工作階段會產生相符項目票證，以追蹤配對嘗試建立。 票證，例如，遊戲的對應或播放程式層級，以及屬性的票證工作階段中，播放程式中的屬性用來判斷相符項目。
#### <a name="hoppers"></a>Hoppers

Hoppers 個相符項目票證的收集位置的邏輯位置。 只有相同 hopper 內的票證可以比對。 標題可以有多個 hoppers。 例如，標題可能會建立一個 hopper 技能的播放程式是最重要的項目進行比對。 它可能會使用另一個 hopper 中播放器只表示相符購買相同可下載的內容。


#### <a name="hopper-rules"></a>Hopper 規則

Hopper 規則提供定義群組在一起配對服務會使用播放程式決定的準則。 有兩種類型的規則： 必須一定要相符項目才會被視為相容的票證所需滿足的規則。
-   應該規則--比對規則的相符項目票證會優先使用另一個沒有。

在每個這些類別中，有幾個特定類型的規則。 如需詳細資訊，請參閱中的執行階段作業組態資訊**SmartMatch 執行階段作業**。


### <a name="match-target-session"></a>比對目標工作階段

一旦已找到相符的群組，服務就會建立比對的目標工作階段，並從一起比對的票證工作階段的所有球員的保留位置。


## <a name="smartmatch-runtime-operations"></a>SmartMatch 執行階段作業



| 注意                                                                                                                                  |
|----------------------------------------------------------------------------------------------------------------------------------------------------|
| 如需使用 SmartMatch 配對您的標題中的資訊，請參閱[使用 SmartMatch 配對](using-smartmatch-matchmaking.md)。 |


### <a name="creating-a-match-ticket-session-and-a-match-ticket"></a>建立比對票證工作階段，而且符合票證

指定為"scout 」 配對的用戶端設定來表示一群想要輸入配對的球員的相符項目票證工作階段。 此群組中的所有播放程式將使用 MultiplayerSession.Join 方法的工作階段。 一旦工作階段已填入的播放程式中，標題會提交到使用 MatchmakingService.CreateMatchTicketAsync 方法，這會建立代表工作階段的相符項目票證配對服務的工作階段。

| 注意                                                                                                                                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CreateMatchTicketAsync 作業期間，SmartMatch 服務會更新 /servers/matchmaking/properties/system/status 欄位 「 搜尋 」 票證工作階段中。 |

比對的票證建立方法的回應是 CreateMatchTicketResponse 物件。 此回應包含比對的票證識別碼，可用來取消藉由刪除票證的配對的 GUID。 此外，用於設定播放程式預期的回應中包含 hopper 平均等候時間。

| 注意                                                                                                                                                                                                                                                                                                                                 |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 除非必須保留的特定遊戲狀態資料，否則建議您使用標題在呼叫 CreateMatchTicketAsync 時，會使用 PreserveSessionMode.Never 值。 使用 PreserveSessionMode.Never 允許更快速的配對，並不需要有使用者介面選項可用來裝載而不是搜尋遊戲的遊戲。 |


### <a name="setting-matchmaking-attributes-on-the-session-and-players"></a>在工作階段和播放器上設定配對屬性

當提交票證工作階段，設定工作階段標題，並播放程式屬性 (attribute) 配對服務會使用群組與其他工作階段的工作階段。 在票證層級或成員層級，可以指定屬性。


### <a name="setting-matchmaking-attributes-at-the-match-ticket-level"></a>在比對的票證層級設定配對屬性

標題送出符合票證中層級 ticketAttributesJson MatchmakingService.CreateMatchTicketAsync 方法參數的屬性。 在票證層級指定的屬性會覆寫在每個成員層級指定的相同屬性。


#### <a name="setting-matchmaking-attributes-at-the-per-member-level"></a>在每個成員層級設定配對屬性

標題會指定符合票證工作階段中每個成員上的每個成員的屬性。 這些是由呼叫 MultiplayerSession.SetCurrentUserMemberCustomPropertyJson; 方法，使用 「 matchAttrs"的屬性名稱進行設定。 此呼叫置於屬性 /members/ {index} / 屬性/自訂/matchAttrs 票證工作階段中欄位每個播放程式上。

配對程序 「 扁平化 」 每個每個成員到單一的票證層級屬性，指定該屬性中的 Xbox Live 設定 UI hopper flatten 方法為基礎。 這可以在 設定[XDP](https://xdp.xboxlive.com)或是[合作夥伴中心](https://partner.microsoft.com/dashboard)。


### <a name="making-the-match"></a>使比對

票證工作階段和票證設定配對服務相符的項目代表其他群組中，其他票證工作階段的票證表示工作階段並建立或識別比對目標工作階段。 此服務也會保留項目相符的玩家建立目標工作階段中，並視為相符，然後將標記票證工作階段。 MPSD 然後通知票證工作階段的這項變更的標題。

現在標題必須初始化目標工作階段，以確認足夠玩家已顯示，並執行服務 (QoS) 檢查，以確保它們可以連接至另一部成功的品質。 如果初始化和/或 QoS 失敗，標題就會標示要提交至配對，以便您可以找到另一個群組的票證工作階段。 如需有關此程序的詳細資訊，請參閱 <<c0>  **目標工作階段初始化與 QoS**。

比對活動期間會以 JSON 物件的工作階段進行下列變更：

-   /servers/matchmaking/properties/system/status 欄位設為 「 找到 」。
-   /servers/matchmaking/properties/system/targetSessionRef 欄位設為目標的工作階段。
-   /members/ {index} / 屬性/自訂每個票證工作階段的 matchAttrs 欄位複製到成員 / {索引} / 常數/自訂/matchmakingResult/playerAttrs 欄位。
-   對於每個播放器，票證屬性從 ticketAttributes 票證中欄位相符項目複製到 /members/ {index} / 常數/自訂/matchmakingResult/ticketAttrs 欄位。


### <a name="maintaining-the-match-ticket"></a>維護的相符項目票證

配對服務會在相符項目票證建立工作階段的時間使用票證工作階段的快照集。 因此，如果任何玩家加入或離開票證工作階段，標題必須刪除並重新建立比對票證使用配對的服務。


### <a name="filling-spots-in-an-in-progress-game-session"></a>在進行中的遊戲工作階段中的填滿點

標題可以重複使用現有的遊戲工作階段，若要尋找更多玩家遊戲已在進行中，加入或填滿遊戲工作階段完成一輪後和保留某些播放器的相符項目票證工作階段。 此程序稱為 「 回填 」。

一種方式來執行回填是建立符合票證會 「 保留 」 的進行中工作階段中，藉由呼叫**MatchmakingService.CreateMatchTicketAsync 方法**preserveSession 參數設定為PreserveSessionMode.Always。 然後配對服務可確保整個配對程序中，保留現有的工作階段，並會成為產生的目標工作階段。

由於 preserveSession 設為 永遠使用兩個工作階段將無法與其他比對，因為無法將它們合併，則需要有此模式中，有可能的缺點。 這會導致非常緩慢的回填配對。 若要避免這種情況下，標題應該只使用 PreserveSessionMode.Always 是否需要保留遊戲的狀態。 Otherwis 設定 PreserveSessionMode.Never，並在找到相符項目時，將播放程式移轉至新 targetSession。


### <a name="deleting-the-match-ticket"></a>刪除符合票證

若要刪除的相符項目票證標題會呼叫**MatchmakingService.DeleteMatchTicketAsync 方法**。 在 刪除票證配對服務：

1.  票證工作階段中的使用者的停駐點配對。
2.  更新票證工作階段中的 /servers/matchmaking/properties/system/status 欄位 「 取消 」。


### <a name="matchmaking-for-games-using-xbox-live-compute"></a>配對遊戲使用 Xbox Live 計算

下列範例示範使用 Live 計算服務的高層級配對。 類似的方法可以套用到裝載於第三方資源上的遊戲。

1.  'Scout' 用戶端會建立代表群組的票證工作階段。 此工作階段包含一份潛在的資料中心，位於 /constants/system/measurementServerAddresses 中的工作階段設定。 它來自其中一個工作階段範本中，如果資料中心清單是靜態的或從用戶端在收到來自 Live 計算服務之後的工作階段建立時。 此工作階段也包含 gsiSetId、 gameVariantId 和 maxAllowedPlayers targetSessionConstants/自訂/gameServerPlatform 物件中的值。
2.  在群組中的所有用戶端會加入此票證工作階段。
3.  群組的所有成員會都下載 measurementServerAddresses 值從 /constants/system 物件票證工作階段。 每個成員則 ping 每個使用 API 的平台的位址，而且 /members/ {index} 中所定義，將慣用的資料中心的已排序的清單上傳至工作階段，/屬性/系統/serverMeasurements。

| 注意                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 標題可以設定和擷取工作階段使用 measurementServerAddresses 值**MultiplayerSession.SetMeasurementServerAddresses 方法**而**MultiplayerSessionConstants.MeasurementServerAddressesJson 屬性**。 |

4.  'Scout' 用戶端呼叫**MatchmakingService.CreateMatchTicketAsync 方法**，傳遞票證工作階段的參考。

| 注意                                                                                                                                                                                                  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 如果票證工作階段物件有不相符的常數，CreateMatchTicket 方法可能會失敗。 這可以避免加入不可 hopper 規則，並防止播放程式具有不相符的常數的比對。 |

5.  如果**MatchTicketDetailsResponse.PreserveSession 屬性**設為 [永不]，配對服務伺服器測量結果從複製的每個成員到票證的簡維前的內部表示法收集成單一集合進行票證並儲存為 「 特殊 」 票證屬性。
6.  如果**MatchTicketDetailsResponse.PreserveSession 屬性**已設定為永遠，度量不會使用伺服器。 相反地，配對服務 /properties/system/matchmaking/serverConnectionString 會將值複製工作階段的票證，為 serverMeasurements 集合大小為 1 具有零延遲的內部表示法。
7.  配對服務符合票證工作階段與其他人代表其他群組，讓伺服器至帳戶的度量集合。 它會嘗試比對具有高慣用的相同資料中心的其他群組的群組。
8.  一旦已找到相符的群組，配對服務就會建立或識別目標工作階段並將所有玩家一起比對的票證工作階段。 服務會將相符的群組的最終的扁平化的伺服器測量值寫入至 /properties/system/serverConnectionStringCandidates。 然後再寫入每個新成員的原始伺服器測量值在目標工作階段中 /members/ {index} / 常數/系統/matchmakingResult/serverMeasurements。
9.  所有用戶端會執行初始化，如上面所討論的目標工作階段上。 不過，因為用戶端會連接到即時計算，它們不會執行 QoS 互相確認連線能力。
10. 部分或所有用戶端呼叫**GameServerPlatformService.AllocateClusterAsync 方法**。 第一個會觸發配置，而其他人收到只認可。 方法會取得從 MPSD 的目標工作階段，並選擇 dataceter，根據資料中心喜好設定中的目標工作階段，以及負載和其他即時計算特定的知識。
11. 所有用戶端播放。

## <a name="configuring-smartmatch-for-your-title"></a>設定 SmartMatch 標題


### <a name="configuration-of-smartmatch-matchmaking-runtime-operations"></a>SmartMatch 配對執行階段作業的組態

SmartMatch 配對的所有設定都穿過[Xbox 開發人員入口網站 (XDP)](https://xdp.xboxlive.com)或是[合作夥伴中心](https://partner.microsoft.com/dashboard)。 設定使用 ServiceConfiguration-&gt;多人遊戲 & 配對項目的區段。


#### <a name="matchmaking-session-template-configuration"></a>配對的工作階段範本設定

中所述[SmartMatch 配對](/windows/uwp/xbox-live/multiplayer/multiplayer-appendix/smartmatch-matchmaking)，有兩種類型的配對，比對的票證工作階段和比對目標工作階段相關的工作階段。 基本上，票證工作階段都是 「 配對 」 服務，輸入目標工作階段時輸出。 當設定工作階段範本，您應該建立每個工作階段類型的範本。

票證工作階段中，您可以使用專用的範本。 或者，您可以針對大廳工作階段或不適合用於遊戲的其他工作階段重複使用範本。

| 重要事項                                                                                      |
|-------------------------------------------------------------------------------------------------------------|
| 票證工作階段不能啟用此項目，QoS 檢查，而必須未標示為 「 遊戲 」 功能。 |

目標工作階段中，您必須使用 matchmade 遊戲是範本。 它應該已啟用 QoS 檢查玩遊戲的方式，開始執行之前的對等之間，且必須標記為 「 遊戲 」 功能設定。

與設定 XDP 或合作夥伴中心的 UI 中，您可以將每個工作階段對應至一或多個 hoppers，每個包含的規則，以決定工作階段會比對方式一起在該 hopper。 如需詳細資訊，請參閱 < 基本 Hopper 組態的配對。


#### <a name="basic-hopper-configuration-for-matchmaking"></a>配對的基本 Hopper 組態

此區段會定義用來設定基本 hopper 欄位的欄位。 此設定之後，您必須設定 hopper 規則，Hopper 設定規則中所述。

![](../../images/multiplayer/session_template_hopper_edit.png)


###### <a name="name"></a>名稱

Hopper 時送出到配對的工作階段所使用的名稱。 此名稱必須符合傳遞做為參數的值**CreateMatchTicketAsync**符合票證建立期間的方法。


###### <a name="minmax-group-size"></a>最小/最大群組大小

要從 hopper 中的工作階段建立的播放程式群組最小和最大大小。 配對服務會嘗試建立相符的群組越好，但不超過最大的群組大小一樣大。 不過，它會建立相符的群組，如果它可以組合以符合最小的群組大小不足，無法播放程式。


###### <a name="should-rule-expansion-cycles"></a>應該在竟下展開循環

應該針對規則，配對服務會嘗試增加搜尋空間並提供的配對規則放寬一段時間，如果不找到任何成功的比對。 此程序會透過多個循環，為指定的使用應該規則擴充循環的欄位。 在最後一個擴充的週期，使它們不再防止票證比對，會卸除應該規則。 不過，它們仍用來判斷最符合項目，如果可用的多個的票證。 只有數字和 QoS 類型會展開之前會加以捨棄。 請參閱本主題中 Hopper 設定規則。

增加的應該規則 Explansion 循環設定提供更多的循環的值應該在竟下擴充，但也會增加配對持續時間。 預設值為 3，這是通常足以應付大部分的設定。

| 重要事項                                                                                                                                                                        |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 展開週期發生在固定的時間間隔為 5 秒。 在最後一個擴充週期中，所有 「 應該 」 規則會不會再考慮配對嘗試的其餘部分。 |

##### <a name="ranked-hopper"></a>排名的 Hopper
通常 SmartMatch 會防止封鎖的播放器要比對。 如果檢查排名 Hopper 時，此邏輯會略過以避免使用此系統以避免在播放程式的更高的技巧。

#### <a name="configuration-of-hopper-rules"></a>Hopper 規則的設定

此區段會定義用來設定規則 hopper 的欄位。

###### <a name="common-rule-fields"></a>一般規則欄位

在本節中所定義的欄位通用於所有 hopper 規則。

**規則名稱**

基於組態目的規則所顯示的易記名稱。

**規則類型**

規則類型。 選項為必須和應該。 必須能夠成功的配對所需滿足的規則。 應該規則可以是寬鬆及/或不成功的相符項目中移除。 如需此程序的詳細資訊，請參閱組態的應該規則擴充。


**資料類型**

配對規則的屬性資料型別。 可能值為： 數字。 指定簡單的 32 位元數字值。
-   字串。 指定最多可有 128 個字元的 Unicode 字串。
-   集合。 指定字串的陣列。 您可以使用此值來識別可下載的內容 (DLC)、 警察局的刑事組成員資格或播放程式的角色喜好設定。
-   服務的品質。 指定自訂資料類型包括在配對中的 QoS 資料延遲。 每個配對 hopper 應只有一個這類規則。

| 注意 |
|----------|
| 請如果這項限制會造成問題的標題，連絡您的開發人員帳戶管理員。 |

-   總計值。 指定加總提交的配對值的自訂資料類型。 您可以使用此值，以確保產生的加總的特定範圍內，或為精確的值。
-   小組。 指定小組的播放程式在配對的要求中包含自訂資料類型。 您可以使用此值，以避免分割內的多個小組之間的單一相符項目票證的播放程式。


###### <a name="data-type-specific-rule-fields"></a>資料型別特有規則欄位

此區段會定義用來定義規則以套用至某些資料類型，而非其他欄位。 UI 應該可以釐清哪些資料型別會套用特定規則。

**允許萬用字元**

值，指出是否可符合票證中省略的屬性。 如果省略，票證會變成相容於其他票證，這個屬性的值為何。


**屬性來源**

資料來源的輸入值。 可能的來源為：
- 提供的標題。 符合票證中提交的資料值。
-   使用者狀態的執行個體。 從 UserStatistics 服務自動擷取的資料值。


**屬性名稱**

屬性值來源的名稱。 它是符合票證中的屬性名稱或使用者統計資料的名稱。


**預設值**

如果沒有值會指定或適用於配對要求的資料型別預設值。 選取 [允許使用萬用字元] 欄位並使用未不指定任何值，不會套用預設值。


**權數**

規則的重要性。 權數可用來指出哪些規則會在配對和規則的展開期間排定優先順序。 加權值必須是正數，和預設值為 1。


**Flatten 方法**

數字資料類型。 值，指出如何將多個值組合來滿足相符項目。 它適用於多個值不同的玩家參與單一相符項目票證中和跨多個的票證。 可能的值為：
-  最小/最大。 使用多個值，從不同的相符項目票證的最小值或最大值。
-   平均值。 使用從不同的相符項目票證的多個值的平均值。


**最大的差異**

數字資料類型。 最大可接受數字之間的差異兩個比較的值，以滿足的規則。 應該針對規則，這個值是規則擴充的起點。


**設定作業**

集合資料類型。 要比對的設定值的群組上執行的作業。 可能的選項包括：
- 交集。 比對兩個集合會根據它們之間的交集的數量。 此設定會導致類似或相同的集合值。
-   差異。 比對兩個集合會根據它們之間的差異數量。
-   角色喜好設定。 比對的喜好設定以角色為基礎的遊戲模式的推手角色為基礎的集合。


**目標的交集**

設定作業組態的一部分。 最小的交集或兩個集合，它們會比對之前的最大差異。


**網路拓撲**

品質的服務資料型別。 使用 QoS 的網路拓撲。 可能的值為對等，主機和用戶端/伺服器的對等。


**最大延遲/調整大小的最大值**  
品質的服務資料型別。 指定的網路拓撲內成功配對最大延遲。 這個值會被視為縮放比例的值 （相對於所需的延遲） 時使用之服務的用戶端-伺服器品質應該規則。


| 注意                                                                                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 另外，預設信譽規則也會套用至 hopper。 這些規則無法移除，而且用來確保正確處理期間配對的評價。 |


**允許等候角色**

集合角色喜好設定資料類型。 指定是否相符項目服務會保留配對票證以填滿所有可用的角色。


###### <a name="expansion-delta"></a>展開差異

值，指出多少放寬提交的規則，針對每個展開的層代。 除了最大差異比對值套用展開差異。 如需詳細資訊，請參閱範例 1 （規則展開）。

您也可以使用擴充的差異，以展開多個不同的速度的數字值。 這不是透過擴充循環組態設定，因為它適用於所有的規則。 相反地，方法是使用十進位的展開值，例如，0.4。 達到新的整數，可讓不同的擴充速度，即使是針對相同數目的展開循環時，才會發生擴充功能。


###### <a name="qos-expansion-peer-to-peer-peer-to-host"></a>QoS 展開 （-對等，對等電腦來裝載）
對等遊戲的服務類型展開的品質，無法設定展開差異。 相反地，您應該使用其中一個下列的擴充策略。

<table>

<tr>

<tr>
<td>
<b>1. MaxLatency < 256.</b><p/><p/>

擴充是在 MaxLatency * 擴充循環。<p/>
比方說，如果初始的值為 200，則 200 會使用在第一個循環，在第二個週期，400 等等。
</td>
</tr>

<tr>
<td>
<b>2. MaxLatency > 或等於 256</b><p/><p/>

展開以線性方式調整從 50 MaxLatency-256。<p/>
比方說，如果 556 的初始值，值會調整以線性方式從 50 到 300 之間透過循環的次數。 也就是說，如果用意，是六個循環，則值會 50、 100，150，200，250 和 300。 如果已選擇五個循環，值會是 50、 112.5、 175、 237.5 和 300。
</td>
</tr>

</tr>
</table>

##### <a name="qos-expansion-client-server"></a>QoS 擴充 （用戶端-伺服器）
使用專用的伺服器時，會將擴充根據相對的喜好設定。 只有最慣用的伺服器會被視為早期擴充循環中。 經過一段時間，其他項目，較慣用的伺服器不會使用。 若要確保適當的擴充，我們需要類似 MaxLatency，稱為 最大縮放值。 此調整最大值應該仍然設定為最大的可接受的 ping 時間，不過，這個值會提供以相對比例，播放程式，而不是提供 ping 時間是絕對需求提供不同的伺服器 ping 時間。 請注意，您可能會從要求中的清單中移除，刻意排除無法接受的 ping 時間伺服器。

#### <a name="example-1-rule-expansion"></a>範例 1 （規則展開）

播放程式層級用於配對，而且播放程式會比對鬆散，根據其層級的相似程度。 較好的玩家以其層級之間的差異的最少。

-   播放程式層級的規則
-   規則類型：應該
-   Data Type:Number
-   最大差異：1
-   展開差異：2
-   Flatten 方法：平均

根據預設，播放程式層級所需的差異是 1 或更少。 如果找到相符項目內這項差異，播放程式會比對。 如果找到初始相符項目，則針對每個反覆項目 （預設情況下三個反覆項目） 的 2 展開播放程式層級值。 此案例會導致配對行為層級 20，播放程式在下表中所示。

| 步驟                    | 潛在的比對候選項目層級值 | 比對成功的有效層級的距離 |
|-----|
| 初始提交值 | 19-21                                      | 1                                             |
| 展開週期 1       | 17-23                                      | 3                                             |
| 展開週期 2       | 15-25                                      | 5                                             |
| 展開週期 3       | 13-27                                      | 7                                             |

繼續展開循環，成功的比對之有效層級距離會增加而不需要變更的最大差異值。 播放程式層級值將會較為寬鬆。


#### <a name="example-2-collection-rule"></a>範例 2 （集合規則）

遊戲版本可供玩家 DLC 的三個型別。 此配對規則會套用至 「 只 DLC 」 遊戲進行配對，且播放程式應該擁有至少一個要與其他玩家 matchmade DLC。

-   播放程式 DLC 規則
-   規則類型：必須
-   Data Type:集合
-   設定作業：交集
-   目標的交集：1

播放程式會評估其 DLCs，並提交其符合票證中的下一步 資料表中顯示的值。

| 注意                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| 下表中的集合值會指出 DLC 的擁有權。 如果 DLC 時才可以使用播放程式，並為 0 不，它會設定為 1。 |

| 播放程式   | 集合值 | 比對的播放程式 | 注意           |
|----------|------------------|----------------------|----------------|
| 播放器 1 | { "1", "1", "1"} | 3                    | 擁有所有 DLCs  |
| 播放程式 2 | { "0", "0", "0"} | 無                 | 不擁有任何 DLC    |
| 播放程式 3 | { "1", "0", "0"} | 1                    | 擁有第一個 DLC |

如果目標交集在範例中設定為 2，1 和 3 的播放程式不將要比對，因為它們之間的交集是只有 1 個。

#### <a name="example-3-avoid-previous-players"></a>範例 3 （避免先前的播放器）
標題會偏好使用播放程式中避免遊戲最近播放。
* 規則類型：必須
* Data Type:集合
* 設定作業：差異
* 目標的交集：0

## <a name="defining-team-rules-during-smartmatch-configuration"></a>SmartMatch 設定期間定義小組規則

### <a name="configuring-team-rules"></a>設定小組規則

若要設定 Team 規則，先建立一個在所選的設定平台 （XDP 或合作夥伴中心） 上。 填寫您的遊戲需要從這個 hopper 中比對的票證建立的小組大小。 比方說，如果您的遊戲需要 4 對 4，您應該建立兩個項目，必須要有大小上限為 4 和不同的名稱。 最少有團隊規模也-如果使用此選項較少的播放程式的小組可以播放遊戲。 否則，最小值和最大值應該是相同的值。


#### <a name="using-team-rules"></a>使用 Team 規則

小組規則設定之後，票證內 hopper 將防止比對，如果沒有任何方法，以符合小組中的群組，而不會造成分割。 此規則會寫入目標工作階段中，成員/常數/自訂/matchmakingresult/initialTeam 下產生的小組配置。 請注意，這只是建議的配置-標題可能會發現，重新排列的球員它可能會建立更棒的遊戲，同時仍然防止票證分割成不同的小組。

如果正在進行中的遊戲建立票證，則小組規則將會需要其他資訊。 比方說，假設，4 對 4 遊戲，若有兩個播放器置放在 8 播放器，或已中斷連線。 標題想要填入這些空白的點，但播放電腦是遊戲時，它不能重新排列小組。

嘗試填滿遊戲進行中的是以表示票證與 PreserveSession 欄位設定為 「 永遠 」。 在這種情況下，因為小組有已配置到播放程式，標題必須指定目前的小組配置，讓相符項目將知道多少空間會在每個小組上開啟。 若要提供的小組名稱每個玩家已開啟，每個播放程式會將其小組名稱寫入遊戲的工作階段中，在 成員/我/屬性/系統/群組。 這個欄位是 JArray。

一旦遊戲工作階段寫入上述的屬性，則單一播放器會建立工作階段，票證以嘗試尋找更多玩家。 當票證滿足時，相符項目會再次將寫入任何加入的球員建議的小組成員/常數/自訂/matchmakingresult/initialTeam


###### <a name="preferring-even-teams"></a>偏好甚至小組

此外，相符項目將會進行與最大的團隊第一次。 這表示在假設 4 對 4 hopper，將會符合票證的 4 個玩家一起第一，直到保持為 4 的票證。 為 3 的票證然後繼續，提取單一子句，如有需要...等等。 以這種方式，票證的大小類似，會通常播放彼此，如果不存在且未導致其他規則。 請注意，這可讓小組規則相當強式優先於其他規則。 例如，假設您有一個票證的大小 4 高 skill(A)、 一個票證的大小 4 與低 skill(B) 和四個票證大小為 1 具有高 skill(C-F) 組成的有限母體擴展。 小組規則會比對希望 A 和 B 比對，而不 A、 C、 D、 E 和 f。


###### <a name="should-variant"></a>應該 Variant

必須規則可防止所有的層代中分割的票證，並提供 prefer 甚至小組排序。 應該規則等同直到最後的生成集-之後，您可能會分割票證，雖然 prefer 甚至小組排序仍可使用。

## <a name="target-session-initialization-and-qos"></a>目標工作階段初始化與 QoS

播放程式群組所比對到目標工作階段 SmartMatch 配對中所述[SmartMatch 配對](/windows/uwp/xbox-live/multiplayer/multiplayer-appendix/smartmatch-matchmaking)。 標題必須採取步驟來確認已加入，它們可以成功連線到另一個需要足夠的播放程式。 此程序稱為目標的工作階段初始化。

使用端對端網路拓撲的遊戲，目標工作階段初始化的重要層面是 QoS 測量和評估。 相關的作業是測量的延遲和頻寬之間 Xbox One 主控台 （或主控台與伺服器之間），並評估來判斷節點之間的網路連線是否良好的測量結果。

下列流程圖說明如何實作在目標工作階段的 QoS 作業初始化。

![](../../images/multiplayer/Multiplayer_2015_Matchmaking_QoS.png)

### <a name="managed-initialization"></a>受管理的初始設定

MPSD 支援稱為 「 managed 初始化 」 透過此它協調目標工作階段初始化處理程序所涉及的工作階段中的用戶端的功能。 MPSD 自動會初始化階段和相關聯的逾時追蹤工作階段，並評估用戶端之間的連線，如有需要。 受管理的初始設定由**MultiplayerManagedInitialization 類別**。

| 注意                                                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------|
| 強烈建議標題使用 SmartMatch 配對，以充分利用 MPSD managed 初始化功能。 |


#### <a name="managed-initialization-episodes-and-stages"></a>Managed 的初始化劇集和階段

目標工作階段會進行 managed 的初始化每當配對會將新的播放程式加入至工作階段。 SmartMatch 會新增工作階段的成員，作為使用者狀態保留，這表示每個成員會佔用一個位置，但尚未加入工作階段。 每個群組的新的播放程式就會觸發新的初始化一集。

完成初始設定的詳細資訊，每個玩家成功或失敗的程序。 成功地初始化玩家可以播放使用目標工作階段。 失敗玩家必須重新提交到要比對到另一個工作階段配對。 其中一個工作階段就會提交至配對與案例*preserveSession*參數設定為 Always 時，工作階段的預先存在的成員不會執行進行初始化，因為 MPSD 假設它們適當地設定。

每個 managed 的初始化一集是由這些階段所組成：

-   加入-工作階段成員本身寫入以將其使用者狀態從保留移至 作用中，工作階段，並上傳基本的資料，例如安全的裝置位址。
-   度量-同儕為基礎的拓撲中，工作階段成員測量 QoS，並將結果上傳到工作階段。
-   評估-MPSD 評估的最後兩個階段中，結果，並判斷是否的工作階段及/或成員已順利初始化。

標題的程式碼會向前 「 聯結 」 和 「 測量階段中的每個使用者 （以及在工作階段） 的工作階段上運作。 它接著可以開始播放或返回配對之後的評估階段成功或失敗。


### <a name="configuring-the-target-session-for-initialization"></a>設定目標工作階段初始化

標題可以設定受管理的初始化程序使用中的目標工作階段初始化。 這些常數會設定下 /constants/system 版本 107，建議的範本版本與工作階段範本中。 可以進行兩種類型的組態設定： 整體而言，設定受管理的初始化程序的設定和設定 QoS 需求的設定。 請參閱[MPSD 工作階段範本](multiplayer-session-directory.md)如標題的常見案例的工作階段範本的範例。

| 注意                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------------|
| 如果在初始化期間的測量階段會略過的目標工作階段初始化組態中未定義服務需求品質。 |


#### <a name="configuring-managed-initialization-as-a-whole"></a>設定受管理的整體的初始化

以下是要設定來控制整體的 managed 的初始化的欄位。 它們屬於 /constants/system/memberInitialization 物件：
- joinTimeout。 指定 MPSD 與要加入，請在開始初始化集後的每個成員之間的等待時間長度。 預設值為 10 秒。
-   measurementTimeout。 指定 MPSD 與在測量階段開始後，請上傳 QoS 測量結果，每個成員之間的等待時間長度。 預設值為 30000 的秒數。
-   membersNeededToStart。 指定必須成功，在第一次的初始化時段，才會成功初始化的成員數目。 預設值為 1。

| 注意                                              |
|----------------------------------------------------------------|
| 如果不符合此閾值時，所有成員就會都失敗初始化。 |


#### <a name="configuring-qos-requirements"></a>設定 QoS 需求

QoS 才會需要在初始化期間，如果標題使用的對等或對等電腦來裝載的拓撲。 每種拓撲會對應至下 /constants/系統/拓撲特定常數。
###### <a name="configuring-qos-requirements-for-peer-to-peer-topology"></a>設定對等項目-拓樸的 QoS 需求

| 注意                                                                                                                                                                                         |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 很少的標題，使對等項目-拓撲的 QoS 需求設定。 這些設定是相當有限，並嚴格的網路位址轉譯 (Nat) 的播放程式會造成問題。 |

對等項目-拓撲 QOS 需求為 peerToPeerRequirements 物件中。 每個用戶端必須能夠連線到每個用戶端。 物件具有下列相關的欄位：
-   latencyMaximum。 指定任何兩個用戶端之間的延遲上限。
-   bandwidthMinimum。 指定任何兩個用戶端之間的最小頻寬。


###### <a name="configuring-qos-requirements-for-peer-to-host-topology"></a>設定對等電腦來裝載拓樸的 QoS 需求

對等電腦來裝載拓樸的 QOS 需求為 peerToHostRequirements 物件中。 每個用戶端必須能夠連線到單一的常見主機。 如果此物件已初始化成功，MPSD 會建立可能的主機，稱為 「 主機候選項目。 」 的用戶端的初始清單 以下是要設定的欄位：
-   latencyMaximum。 指定每個對等和主機之間的延遲上限。
-   bandwidthDownMinimum。 指定每個對等與主機之間的最小下游的頻寬。
-   bandwidthUpMinimum。 指定每個對等與主機之間的最小上游頻寬。
-   hostSelectionMetric。 指定用來選取主機的計量。

## <a name="see-also"></a>請參閱

[MPSD 工作階段範本](multiplayer-session-directory.md)

[SmartMatch 執行階段作業](/windows/uwp/xbox-live/multiplayer/multiplayer-appendix/smartmatch-matchmaking)
